<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>مساعد المستندات الذكي</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #f9fafb 42%, #f1f5f9 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      color: #0f172a;
    }
    .card {
      width: 100%;
      max-width: 480px;
      background: #ffffff;
      border-radius: 24px;
      padding: 24px 22px 20px;
      box-shadow: 0 20px 50px rgba(15,23,42,0.15);
    }
    .title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 20px;
    }
    .field {
      margin-bottom: 14px;
    }
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      color: #475569;
    }
    input[type="file"],
    input[type="email"] {
      width: 100%;
      padding: 10px 11px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      background: #f8fafc;
    }
    input[type="file"]:focus,
    input[type="email"]:focus {
      border-color: #0f766e;
      box-shadow: 0 0 0 1px rgba(15,118,110,0.2);
      background: #ffffff;
    }
    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #475569;
      margin-bottom: 16px;
      user-select: none;
      cursor: pointer;
    }
    .checkbox-row input {
      width: 14px;
      height: 14px;
      accent-color: #0f766e;
      cursor: pointer;
    }
    button {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #0f766e, #14b8a6);
      color: #ecfeff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.15s ease;
      box-shadow: 0 12px 30px rgba(15,118,110,0.4);
    }
    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(15,118,110,0.45);
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }
    .status {
      margin-top: 10px;
      font-size: 12px;
      color: #64748b;
      min-height: 16px;
    }
    .status.error {
      color: #b91c1c;
    }
    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
      margin-top: 2px;
    }
    .badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #ecfeff;
      color: #0f766e;
      border: 1px solid rgba(15,118,110,0.12);
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="title">مساعد المستندات الذكي</div>
    <div class="subtitle">ارفع أي ملف (PDF,TXT) وخذ تقرير PDF جاهز بالتحليل والملخص.</div>

    <div class="badge-row">
      <div class="badge">تحليل CV</div>
      <div class="badge">ملخص محاضرات</div>
      <div class="badge">مراجعة أبحاث</div>
      <div class="badge">تلخيص مستندات</div>
    </div>

    <form id="docForm">
      <div class="field">
        <label for="file">الملف</label>
        <input type="file" id="file" name="file" required accept=".pdf,.txt" />
      </div>

      <div class="field">
        <label for="email">الإيميل (اختياري – يوصلك التقرير)</label>
        <input type="email" id="email" name="email" placeholder="name@example.com" />
      </div>

      <label class="checkbox-row">
        <input type="checkbox" id="sendEmail" name="sendEmail" />
        <span>أرسل لي التقرير أيضًا على الإيميل</span>
      </label>

      <button type="submit" id="submitBtn">
        <span id="btnText">تحليل المستند الآن</span>
        <span id="btnSpinner" style="display:none;">...</span>
      </button>

      <div class="status" id="status"></div>
    </form>
  </div>

  <script>
    const form = document.getElementById('docForm');
    const statusEl = document.getElementById('status');
    const btn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');

    const WEBHOOK_URL = 'https://falshasafey.app.n8n.cloud/webhook-test/4bb681f6-fadf-44cc-8ff7-74a23a226c9d'; // حطي رابط Webhook من n8n

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '';
      statusEl.classList.remove('error');

      const fileInput = document.getElementById('file');
      if (!fileInput.files || fileInput.files.length === 0) {
        statusEl.textContent = 'حمّلي ملف أول.';
        statusEl.classList.add('error');
        return;
      }

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      const email = document.getElementById('email').value.trim();
      const sendEmail = document.getElementById('sendEmail').checked;

      if (email) formData.append('email', email);
      if (sendEmail) formData.append('sendEmail', 'on');

      btn.disabled = true;
      btnText.textContent = 'جاري التحليل...';
      btnSpinner.style.display = 'inline-block';
      statusEl.textContent = 'قد يستغرق الأمر ثوانٍ حسب حجم الملف.';

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: 'POST',
          body: formData
        });

        if (!res.ok) {
          throw new Error('خطأ في السيرفر');
        }

        // نتوقع PDF مباشرة من الـ Webhook
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'smart-document-report.pdf';
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

        statusEl.textContent = 'تم توليد التقرير وتحميله. (لو حطيتي إيميل ممكن يوصلك نسخة إضافية)';
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'صار خطأ أثناء التحليل. تأكدي من الرابط أو جربي ملف أصغر.';
        statusEl.classList.add('error');
      } finally {
        btn.disabled = false;
        btnText.textContent = 'تحليل المستند الآن';
        btnSpinner.style.display = 'none';
      }
    });
  </script>
</body>
</html>
